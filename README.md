# Rutube QA

Этот репозиторий состоит из нескольких подпроектов, каждый из которых выполняет свою задачу для реализации вопросно-ответной системы на основе моделей ретрива и ранжирования документов. Основная цель проекта — предоставление пользователю релевантных ответов из базы знаний. Описание подпроектов и их структуры приведено ниже.

## Структура проекта

### docs/
Этот модуль включает в себя скрипты для генерации вопросов и ответов на основе документов в формате docx, а также их последующую классификацию. Выполняемые задачи:
- Разбиение спаршенных документов docx на фрагменты.
- Генерация новых вопросов и ответов по этим фрагментам.
- Классификация сгенерированных вопросов и ответов по категориям.
- Запись результатов в формате JSON.
- Конвертация данных в CSV-формат для дальнейшего использования.

### rag/
Модуль для реализации RAG (Retrieval-Augmented Generation) пайплайна. Основные компоненты:
- **prompts.py** — содержит промпты, используемые для генерации вопросов и ответов.
- **embedding_model.py** — класс для работы с эмбеддингами в модели ретрива.
- **rag_utils.py** — реализация цепочки RAG, связывающей ретриверы и генеративные модели.
- **utils.py** — вспомогательные функции для предобработки данных.

### retriever/
Модуль ретривера, предназначенный для быстрого поиска N релевантных документов из базы знаний, используя векторизацию вопросов и ответов.

#### Подготовка данных:
Для подготовки данных для обучения нужно выполнить скрипт `make_splits_new.py`, указав путь до исходного CSV файла в переменной `src_csv_file`, и путь до директории с JSON файлами в переменной `synth_dir`. Результатом будет файл `train_val_test.json` с разделением данных на обучающую, тестовую и валидационные выборки.

#### Обучение модели:
Запуск обучения производится через конфигурационный файл `configs/default.yaml`. Для запуска обучения необходимо выполнить команду:
```bash
python3 train.py
```

### reranker/
Модуль для обучения кросс-энкодера, который переранжирует потенциально релевантные документы, предсказывая вероятность их соответствия вопросу.

#### Подготовка данных:
Используйте функции из `dataset.py` для подготовки данных, как для претрейна на mMARCO, так и для дальнейшего обучения на сгенерированных данных.

#### Обучение модели:
Конфигурация задается через файл `train_config.yaml`, а обучение запускается командой:
```bash
python3 train.py
```
Результатом будут чекпоинты модели, которые затем загружаются в модель на базе HuggingFace.

#### Использование:
Для выполнения всего пайплайна ранжирования используется класс из файла `handler.py`.

### tg-bot/
Модуль телеграм-бота с поддержкой режима вопрос-ответ.

### vllm/
Модуль VLLM с Dockerfile. Для параллельного запуска vLLM используйте скрипт в корне `run_vllm_parallel.sh`.
